// Generated by CoffeeScript 1.8.0
(function() {
  var marks, removeMarksForTab, root;

  root = window.Marks = {};

  marks = {};

  root.create = function(req, tab) {
    marks[req.markName] = {
      tabId: tab.id,
      scrollX: req.scrollX,
      scrollY: req.scrollY
    };
  };

  chrome.tabs.onUpdated.addListener(function(tabId, changeInfo, tab) {
    if (changeInfo.url == null) {
      return;
    }
    var old = tabInfoMap[tabId], temp;
    if (old) {
      if (old.nohash == null) {
        temp = old.url.indexOf('#');
        old.nohash = temp > 0 ? old.url.substring(0, temp) : old.url;
      }
      temp = changeInfo.url.indexOf('#');
      if (temp > 0 && (tab.nohash = changeInfo.url.substring(0, temp)) === old.nohash) {
        return;
      }
    }
    removeMarksForTab(tabId);
  });

  removeMarksForTab = function(id) {
    for (var markName in marks) {
      if (marks[markName].tabId === id) {
        delete marks[markName];
      }
    }
  };

  root.goTo = function(req, tab) {
    var mark = marks[req.markName];
    chrome.tabs.update(mark.tabId, {
      selected: true
    });
    chrome.tabs.sendMessage(mark.tabId, {
      name: "setScrollPosition",
      scrollX: mark.scrollX,
      scrollY: mark.scrollY
    });
    chrome.tabs.sendMessage(mark.tabId, {
      name: "showHUDforDuration",
      text: "Jumped to global mark '" + req.markName + "'",
      duration: 1000
    });
  };

  chrome.tabs.onRemoved.addListener(removeMarksForTab);

}).call(this);
