"use strict";
// Generated by CoffeeScript 1.8.0
(typeof exports !== "undefined" && exports !== null ? exports : window).Settings = {
  _buffer: {},
  get: function(key) {
    if (! (key in this._buffer)) {
      return this._buffer[key] = (key in localStorage) ? JSON.parse(localStorage[key]) : this.defaults[key];
    }
    return this._buffer[key];
  },
  set: function(key, value) {
    var ref = this.defaults[key];
    if (value === ref || (key in this.forceBoolean && value !== this.forceBoolean[key])) {
      this._buffer[key] = ref;
      if (key in localStorage) {
        delete localStorage[key];
      }
      Sync.clear(key);
    } else {
      this._buffer[key] = value;
      localStorage[key] = ref = JSON.stringify(value);
      Sync.set(key, ref);
    }
    if (ref = this.postUpdateHooks[key]) {
      ref.call(this, value, key);
    }
  },
  clear: function(key) {
    this.set(key, this.defaults[key]);
  },
  has: function(key) {
    return key in localStorage;
  },
  postUpdateHooks: {
    keyMappings: function(value) {
      Commands.clearKeyMappingsAndSetDefaults();
      Commands.parseCustomKeyMappings(value);
      refreshCompletionKeysAfterMappingSave();
    },
    searchEngines: function() {
      this.resetSearchEngines();
    },
    searchUrl: function(value) {
      this.parseSearchEngines(this.get("searchEnginesMap"), "\\ :" + value);
    },
    exclusionRules: function(value) {
      Exclusions.postUpdateHook(value);
    },
    showActionIcon: function(value) {
      setShouldShowActionIcon(value);
    }
  },
  parseSearchEngines: function(map, searchEnginesText) {
    var a, pairs, key, val, name, _i, _j, _k, _len, rColon = /:\s*(.+)/;
    var titles = {};
    map[":"] = map[":"] || titles;
    a = searchEnginesText.replace(/\\\n/g, '').split('\n');
    for (_i = 0, _len = a.length; _i < _len; _i++) {
      val = a[_i].trim();
      if (!val || val[0] === '#') continue;
      pairs = val.split(rColon, 4);
      if (pairs.length !== 3 || !(key = pairs[0].trimRight()) || !(val = pairs[1])) continue;
      pairs = key.split('|');
      _j = pairs.length;
      while (0 <= --_j) {
        if (!(key = pairs[_j].trim())) continue;
        _k = key.indexOf('=');
        if (_k > 0) {
          name = key.substring(_k + 1);
          key = key.substring(0, _k).trimRight();
          if (!key) continue;
          name = name.trimLeft() || key;
        } else if (_k < 0) {
          name = key;
        } else {
          continue;
        }
        map[key] = val;
        titles[key] = name;
      }
    }
  },
  resetSearchEngines: function() {
    var ref = this._buffer.searchEnginesMap = {};
    this.parseSearchEngines(ref, this.get("searchEngines"));
    this.parseSearchEngines(ref, "\\ :" + this.get("searchUrl"));
  },
  defaults: {
    UILanguage: null,
    helpDialog_showAdvancedCommands: false,
    showActionIcon: false,
    vimSync: false,
    showOmniRelevancy: false,
    scrollStepSize: 100,
    smoothScroll: true,
    keyMappings: "# Insert your preferred key mappings here.",
    linkHintCharacters: "asdqwerzxcv",
    linkHintNumbers: "1234567890",
    filterLinkHints: false,
    hideHud: false,
    regexFindMode: false,
    findModeRawQuery: "",
    userDefinedCss: "",
    exclusionRules: [
      {
        pattern: "http*://mail.google.com/*",
        passKeys: ""
      }
    ],
    previousPatterns: "prev,previous,back,<,\u2190,\xab,\u226a,<<",
    nextPatterns: "next,more,>,\u2192,\xbb,\u226b,>>",
    searchUrl: "http://www.baidu.com/s?ie=utf-8&wd=%s",
    searchEngines: "w = Wikipedia (en-US):\\\n  http://www.wikipedia.org/w/index.php?search=%s\nba=Baidu|baidu=Baidu:\\\n  www.baidu.com/s?ie=utf-8&wd=%s",
    newTabUrl: "/index.html", // note: if changed, /pages/newtab.html also needs change.
    settingsVersion: Utils.getCurrentVersion()
  },
  // accept only if value === @forceBoolean[key], so that we get boolean options
  forceBoolean: {
    settingsVersion: "++",
    showActionIcon: true,
    vimSync: true
  },
  ChromeInnerNewTab: "chrome-search://local-ntp/local-ntp.html"
};
