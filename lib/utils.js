// Generated by CoffeeScript 1.8.0
(typeof exports !== "undefined" && exports !== null ? exports : window).Utils = {
  _div: undefined,
  getCurrentVersion: function() {
    return chrome.runtime.getManifest().version;
  },
  invokeCommandString: function(str, arg) {
    var components = str.split('.'), obj = window, _i, _len, _ref;
    for (_i = 0, _len = components.length - 1; _i < _len; _i++) {
      obj = obj[components[_i]];
    }
    obj[components[_len]](arg);
  },
  templateVarRegex: /\{\{([A-Za-z\_][A-Za-z0-9\_]*)\}\}/g,
  makeListRender: function(template, varRegex) {
    var t = template, r = varRegex || this.templateVarRegex, o = null, f = function(i, k) {
      return o[k] || "";
    }, m = function(i) {
      o = i;
      return t.replace(r, f);
    };
    template = null;
    varRegex = null;
    return function(objectArray) {
      var html = objectArray.map(m).join("");
      o = null;
      return html;
    };
  },
  createElementFromHtml: function(html) {
    var tmp = this._div || (this._div = document.createElement("div"));
    tmp.innerHTML = html;
    html = tmp.firstChild;
    tmp.innerHTML = "";
    return html;
  },
  _escapeRegex: /[&<>]/g,
  escapeHtml: function(s) {
    return s.replace(this._escapeRegex, function(c) {
      return (c === '<') ? "&lt;" : (c === '>') ? "&gt;" : "&amp;";
    });
  },
  createUniqueId: (function() {
    var i = 1;
    return function() {
      return ++i;
    };
  })(),
  _chromePrefixes: ["about", "view-source", "chrome-search", "chrome-extension", "data", "javascript"],
  hasChromePrefix: function(url) {
    var index = url.indexOf(':');
    return index > 3 && index < 17 && this._chromePrefixes.indexOf(url.substring(0, index)) >= 0;
  },
  _urlPrefix: /^[a-z]{3,}:\/\//,
  hasOrdinaryUrlPrefix: function(url) {
    return this._urlPrefix.test(url);
  },
  isRefuseIncognito: function(url) {
    return url.startsWith('chrome://') || url.startsWith('chrome-extension://');
  },
  _urlRegex: /^(?:[^:]+(?::[^:]+)?@)?([^:]+|\[[^\]]+\])(?::\d+)?$/,
  _longTlds: ["arpa", "asia", "coop", "info", "jobs", "local", "mobi", "museum", "name", "onion"],
  _ipRegex: /^(\d{1,3}\.){3}\d{1,3}$/,
  convertToUrl: function(string) {
    var host, arr, type = 2, index;
    string = string.trim();
    if (string.indexOf(' ') >= 0) {
    }
    else if (this._urlPrefix.test(string) || this.hasChromePrefix(string)) {
      type = 0;
    }
    else if (!(arr = this._urlRegex.exec((index = string.indexOf('/')) >= 0
      ? string.substring(0, index) : string
    ))) {
      type = 2;
    }
    else if ((host = arr[1]).indexOf(':') >= 0 || host.endsWith("localhost")) {
      type = 1;
    }
    else if ((index = host.lastIndexOf('.')) >= 0) {
      if (this._ipRegex.test(host) || (host = host.substring(index + 1),
        2 <= host.length && (host.length <= 3 || this._longTlds.indexOf(host) >= 0)
      )) {
        type = 1;
      }
    }
    return type === 0 ? string : type === 1 ? ("http://" + string)
      : this.createSearchUrl(Settings.get("searchUrl"), string);
  },
  isTabWithSameUrl: function(old, newTab) {
    var temp;
    if (old) {
      if (old.nohash == null) {
        temp = old.url.indexOf('#');
        old.nohash = temp > 0 ? old.url.substring(0, temp) : old.url;
      }
      temp = newTab.url.indexOf('#');
      if (temp > 0 && (newTab.nohash = newTab.url.substring(0, temp)) === old.nohash) {
        return true;
      }
    }
    return false;
  },
  _searchWordRegex: /%s/g,
  createSearchUrl: function(baseUrl, query) {
    return baseUrl.replace(this._searchWordRegex, encodeURIComponent(query));
  },
  isString: function(obj) {
    return typeof obj === "string" || obj instanceof String;
  },
  distinctCharacters: function(str) {
    var char, unique, _i, _len, _ref;
    unique = "";
    _ref = str.split("").sort();
    for (_i = 0, _len = _ref.length; _i < _len; _i++) {
      char = _ref[_i];
      if (0 > unique.indexOf(char)) {
        unique += char;
      }
    }
    return unique;
  },
  compareVersions: function(versionA, versionB) {
    var a, b, i, _i, _ref;
    versionA = versionA.split('.');
    versionB = versionB.split('.');
    for (i = 0, _ref = Math.max(versionA.length, versionB.length); i < _ref; ++i) {
      a = parseInt(versionA[i] || 0, 10);
      b = parseInt(versionB[i] || 0, 10);
      if (a < b) {
        return -1;
      } else if (a > b) {
        return 1;
      }
    }
    return 0;
  },
  _chromeVerRegex: /Chrome\/([\.\d]+?)\s/,
  haveChromeVersion: function(required) {
    var chromeVersion, _ref;
    chromeVersion = (_ref = navigator.appVersion.match(this._chromeVerRegex)) && _ref[1];
    return chromeVersion && 0 <= Utils.compareVersions(chromeVersion, required);
  },
  zip: function(arrays) {
    return arrays[0].map(function(_, i) {
      return arrays.map(function(array) {
        return array[i];
      });
    });
  },
  _upperRegex: /[A-Z]/,
  hasUpperCase: function(s) {
    return this._upperRegex.test(s);
  }
};

Function.prototype.curry = function() {
  var __slice = Array.prototype.slice, fixedArguments = __slice.call(arguments, 0), fn = this;
  return function() {
    return fn.apply(this, fixedArguments.concat(__slice.call(arguments, 0)));
  };
};

Array.copy = function(array) {
  return Array.prototype.slice.call(array, 0);
};

String.prototype.startsWith || (String.prototype.startsWith = function(str) {
  return this.substring(0, str.length) === str;
});

(typeof global !== "undefined" ? (window || global) : window).extend = function(hash1, hash2) {
  for (var key in hash2) {
    hash1[key] = hash2[key];
  }
  return hash1;
};
